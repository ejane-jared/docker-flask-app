# Build and run a Flask application with Docker
The Python Flask application will print “Hello world!” when accessed via the browser.

# Table of Contents
[Instructions to build and run the Flask application](#instructions-to-build-and-run-the-flask-application)
  - [Build the Docker image](#build-the-docker-image)
  - [Run the Docker image](#run-the-docker-image)

[Documentation of the steps taken to complete this assignment](#documentation-of-the-steps-taken-to-complete-this-assignment)
  - [Prerequisites](#prerequisites)
  - [Step 1: Creating the project folder](#step-1-creating-the-project-folder)
  - 

[Challenges](#challenges)

## Instructions to build and run the Flask application
### Build the Docker image
Clone the Git repository.
```
git clone https://github.com/ejane-jared/docker-flask-app.git
```
In the root level of the project folder, run the following command to build the docker image.
```
docker build -t flaskapp:v1 .
```
(Optional) Verify the docker image was created with the following command.
```
docker images
```

Example output of `docker images`.
```
REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
flaskapp     v1        33fc7ce77c98   2 hours ago      91.7MB
```

### Run the Docker image

```
docker run -d -p 5000:5000 flaskapp:v1
```

(Optional) Verify the container is running with the following command.
```
docker ps
```
Example output of `docker ps`.
```
CONTAINER ID   IMAGE         COMMAND           CREATED          STATUS         PORTS                    NAMES
c1392c606dda   flaskapp:v1   "python app.py"   56 minutes ago   Up 7 seconds   0.0.0.0:5000->5000/tcp   competent_ritchie
```
With the container running, you can now visit http://localhost:5000. 

Below is screenshot of the application's output: <br>
<img src="https://i.imgur.com/gV1d7gz.png" width="400" alt="Screenshot of the Hello world! output in the web browser" >
## Documentation of the steps taken to complete this assignment.

### Prerequisites
Prior to the start of the assignment, the following tools should be installed onto your machine:
- Docker: For the containerization of the application
- Python: The programming language which Flask was built upon
- pip: Python's package installer, which will be used to install Flask
- Flask: The Python-based micro web framework which the app will be created on
- (Optional) An integrated development environment (IDE) of your choice. I used Visual Studio Code (VSCode) to complete this assignment 

### Step 1: Creating the project folder
Create a project folder and give it an appropriate name for this project. Example: `docker-flask-app`

Below is a preview of the completed project folder structure and its files:
```
docker-flask-app
  ├── app.py                  # the python flask application
  ├── Dockerfile              # contains the set of commands needed to assemble a Docker image
  ├── requirements.txt        # list of the required dependencies to run the flask app
  ├── .dockerignore           # tells Docker which files/directories to exclude when building a Docker image
  ├── .gitignore              # specifies intentionally untracked files that Git should ignore
  └── README.md
```
The following steps in this document will provide guidance on writing the contents of each file, as well as building and running the application with docker.

### Step 2: Create the flask application (creating the app.py)

In the root level of your project folder, create an `app.py` file with the following code:
```python
from flask import Flask
import os

app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello, world!"

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(debug=True,host='0.0.0.0',port=port)
```

### Step 3 (Optional): Test running app.py
The flask application can be ran on its own without the need for docker or containers.

In your command line, while under the project folder root, run the following command:
```
python -m flask run
```
Once the command is executed, the output will show the application is running on http://127.0.0.1:5000

If you enter the url into your browser, you should see the webpage generated by the application:<br>
<img src="https://i.imgur.com/4m4GaKv.png" width="400" alt="Screenshot of the Hello world! output in the web browser" >

Press CTRL+C to quit running the flask application

### Step 4: Create the Dockerfile

In the root level of your project folder, create file named `Dockerfile` with the following content:
```dockerfile
# syntax=docker/dockerfile:1

# Get base image (official Python image / Alpine version)
FROM python:3.13-alpine

# Switch to the working directory
WORKDIR /app

# Copy the requirements file into the image
COPY ./requirements.txt /app/requirements.txt

# Install the required dependencies listed from requirements.txt
RUN pip install -r requirements.txt

# Copy all the files from the current folder to the image (any files/extensions listed in .dockerignore will be excluded)
COPY . /app

# Expose port 5000
EXPOSE 5000

# Specifies the starting of the expression to use when starting the container
ENTRYPOINT ["python"]

# Command to run the flask application
CMD ["app.py"]
```

- Used the following documentation to assist in creating the file https://docs.docker.com/reference/dockerfile/
- Changed build image to use official Python image. This would require less steps to be executed in the Dockerfile when compared to a regular linux/alpine image.
- Reordered steps so requirements.txt is copied first before being referenced during the pip install command

### Step 7: Create the .dockerignore file
- Specified README.md in the dockerignore file as that isn’t required for the image build

### Step 8. Create the requirements.txt
- check flask version
- alternatively, pip freeze > requirements.txt
- Gather all requirements for the flask app and place into requirements.txt
  In the root of the project folder, the following command was executed
```
pip freeze > requirements.txt
```

### Step 9: Build the docker image
- Double check docker is installed
- Entered `docker –version` command in terminal
- Entered Build command
  - ```docker build -t flaskapp:v1 . ```
- In terminal, enter `docker images` and checked to see if the ouput listed the image


### Step 10: Run the image in a docker container

```
docker run -d -p 5000:5000 flaskapp:v1
```

### Step 11: View the running application
Navigate to http://localhost:5000, and it works!

# Challenges
Challenge #1: VSCode ran into an import error for flask
Solution:
- flask was not installed in the Python environment currently used in VSCode.
- Ran command `pip install flask` in the terminal of the current environment.

Challenge #2: VSCode showed an error with having an empty Dockerfile
Solution: Added a line of code to indicate which base image to use for the image (FROM alpine:3.14)

Challange #3: Docker daemon not running
- On MacOS, received this error in terminal when running the docker build command
- Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
Solution:
- Downloaded Docker Desktop App and run
- Alternatively: install docker-machine in terminal
- Double check docker is properly running with `docker ps` command in terminal

Challenge #4: The docker container exits immediately when running the `docker run...` command, no container is listed when checking with the `docker ps` command, and checking logs of the container in Docker Desktop shows no errors
Solution:
- Rewrote app.py to explicitly start the flask server, set host accessible on all interfaces (0.0.0.0), and bind the port to 5000
- Once the app.py was update and changes were commited, the docker build command was executed again, as well as the run command, then it worked!
